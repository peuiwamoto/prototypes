<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Customizer - Pliant</title>
    <link rel="stylesheet" href="csv-customizer-v3.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand-name">
                    <img src="https://www.figma.com/api/mcp/asset/5bb754cc-a6d8-4a7f-a9e1-781c70f1e7af" alt="Pliant" class="brand-logo">
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item">
                    <i class="ph ph-grid-four"></i>
                    <span>Dashboard</span>
                </a>
                <div class="nav-section">
                    <div class="nav-section-header">
                        <i class="ph ph-users"></i>
                        <span>Members & Teams</span>
                        <i class="ph ph-caret-down nav-chevron"></i>
                    </div>
                </div>
                <a href="#" class="nav-item">
                    <i class="ph ph-buildings"></i>
                    <span>Accounts</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="ph ph-credit-card"></i>
                    <span>Cards</span>
                </a>
                <div class="nav-section">
                    <div class="nav-section-header">
                        <i class="ph ph-arrows-clockwise"></i>
                        <span>Transactions</span>
                        <i class="ph ph-caret-down nav-chevron"></i>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-header">
                        <i class="ph ph-upload"></i>
                        <span>Account Export</span>
                        <i class="ph ph-caret-down nav-chevron"></i>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-header">
                        <i class="ph ph-file-text"></i>
                        <span>Billing</span>
                        <i class="ph ph-caret-down nav-chevron"></i>
                    </div>
                </div>
                <a href="#" class="nav-item">
                    <i class="ph ph-star"></i>
                    <span>Rewards</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="ph ph-storefront"></i>
                    <span>Merchants</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="ph ph-globe"></i>
                    <span>Pliant Earth</span>
                </a>
                <div class="nav-section expanded">
                    <div class="nav-section-header">
                        <i class="ph ph-gear"></i>
                        <span>Settings</span>
                        <i class="ph ph-caret-up nav-chevron"></i>
                    </div>
                    <div class="nav-section-content">
                        <a href="#" class="nav-item">
                            <span>Organization</span>
                        </a>
                        <a href="#" class="nav-item">
                            <span>Policies</span>
                        </a>
                        <a href="#" class="nav-item active">
                            <span>Accounting</span>
                        </a>
                        <a href="#" class="nav-item">
                            <span>Modules</span>
                        </a>
                        <a href="#" class="nav-item">
                            <span>Integrations</span>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Icons -->
            <div class="header-icons">
                <span class="icon"><i class="ph ph-bell"></i><span class="notification-badge"></span></span>
                <span class="icon"><i class="ph ph-question"></i></span>
                <span class="icon"><i class="ph ph-gear"></i></span>
                <span class="icon"><i class="ph ph-user"></i></span>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <div class="breadcrumb">Settings</div>
                <h1 class="page-title">Accounting</h1>
                
                <!-- Tabs -->
                <div class="tabs">
                    <a href="#" class="tab">General</a>
                    <a href="#" class="tab">G/L Accounts</a>
                    <a href="#" class="tab">VAT Rates</a>
                    <a href="#" class="tab">Suppliers</a>
                    <a href="#" class="tab">Cost Centers & Units</a>
                    <a href="#" class="tab">Accounts</a>
                    <a href="#" class="tab active">CSV Customizer</a>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Step 0: Landing Page -->
                <div class="step-container" id="step0">
                    <div class="landing-page">
                        <div class="landing-header">
                            <div>
                                <h2 class="landing-title">CSV Export Configuration</h2>
                                <p class="landing-description">
                                    Configure column structure, field mappings, formatting and accounting logic for CSV exports. 
                                    This configuration will replace the standard CSV export format.
                                </p>
                            </div>
                            <div class="landing-actions">
                                <button class="btn-secondary btn-large" id="previewConfigBtn">
                                    <i class="ph ph-eye"></i>
                                    Preview
                                </button>
                                <button class="btn-primary btn-large" id="editConfigBtn">
                                    <i class="ph ph-pencil"></i>
                                    Edit Configuration
                                </button>
                            </div>
                        </div>
                        
                        <!-- Configuration Info Card -->
                        <div class="config-info-card" id="configInfoCard">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Step 1: Configuration Screen -->
                <div class="step-container" id="step1" style="display: none;">
                    <div class="config-layout">
                        <!-- Main Content Area -->
                        <div class="config-main">
                            <!-- Config Header -->
                            <div class="config-header">
                                <div class="config-title-section">
                                    <button class="back-btn" id="backToLandingBtn">
                                        <i class="ph ph-arrow-left"></i>
                                    </button>
                                    <div>
                                        <h2 class="config-title">CSV Export Configuration</h2>
                                        <div class="config-meta" id="configMeta">
                                            <!-- Last updated info will be shown here -->
                                        </div>
                                    </div>
                                </div>
                                <div class="config-actions">
                                    <button class="btn-secondary" id="previewBtn">
                                        <i class="ph ph-eye"></i>
                                        Preview
                                    </button>
                                    <button class="btn-primary" id="saveBtn">
                                        <i class="ph ph-floppy-disk"></i>
                                        Save Configuration
                                    </button>
                                </div>
                            </div>

                            <!-- Warning Banner -->
                            <div class="warning-banner" id="warningBanner" style="display: none;">
                                <i class="ph ph-warning"></i>
                                <span>Changes will affect future exports</span>
                            </div>

                            <!-- Global Settings -->
                            <div class="global-settings-section">
                                <div class="global-setting-item">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="globalTwoRowToggle" class="toggle-checkbox-hidden" />
                                        <span class="toggle-switch" id="globalToggleSwitch"></span>
                                        <div class="toggle-text-group">
                                            <span class="toggle-text">Creditor based logic (2 rows per transaction)</span>
                                            <span class="toggle-help">When enabled, each transaction produces two rows (Debit and Credit)</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Simplified Configuration Table -->
                            <div class="config-table-container">
                                <table class="config-table" id="configTable">
                                    <thead>
                                        <tr>
                                            <th class="col-order">Order</th>
                                            <th class="col-header">Column Header</th>
                                            <th class="col-field">Data Field</th>
                                            <th class="col-sample">Sample Value</th>
                                            <th class="col-split" id="splitColumnHeader" style="display: none;">Debit/Credit</th>
                                            <th class="col-status">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="configTableBody">
                                        <!-- Rows will be dynamically added -->
                                    </tbody>
                                </table>
                                <button class="btn-add-row" id="addRowBtn">
                                    <i class="ph ph-plus"></i>
                                    Add column
                                </button>
                            </div>
                        </div>

                        <!-- Configuration Drawer -->
                        <div class="config-drawer" id="configDrawer">
                            <div class="drawer-header">
                                <h3 class="drawer-title" id="drawerTitle">Select a column to configure</h3>
                                <button class="drawer-close" id="closeDrawerBtn">
                                    <i class="ph ph-x"></i>
                                </button>
                            </div>
                            <div class="drawer-content" id="drawerContent">
                                <div class="drawer-empty-state">
                                    <i class="ph ph-cursor-click"></i>
                                    <p>Click on a row in the table to configure its settings</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Preview Screen -->
                <div class="step-container" id="step3" style="display: none;">
                    <div class="preview-header">
                        <button class="back-btn" id="backToConfigBtn">
                            <i class="ph ph-arrow-left"></i>
                        </button>
                        <h2 class="preview-title">Preview Export Output</h2>
                    </div>

                    <div class="preview-content">
                        <!-- Table Preview -->
                        <div class="preview-section">
                            <h3 class="preview-section-title">Table Preview</h3>
                            <div class="preview-table-container">
                                <table class="preview-table" id="previewTable">
                                    <thead id="previewTableHead">
                                        <!-- Headers will be dynamically added -->
                                    </thead>
                                    <tbody id="previewTableBody">
                                        <!-- Rows will be dynamically added -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Raw CSV Preview -->
                        <div class="preview-section">
                            <div class="preview-section-header">
                                <h3 class="preview-section-title">Raw CSV Preview</h3>
                                <div class="preview-actions">
                                    <button class="btn-secondary" id="copyCsvBtn">
                                        <i class="ph ph-copy"></i>
                                        Copy CSV
                                    </button>
                                    <button class="btn-secondary" id="downloadCsvBtn">
                                        <i class="ph ph-download"></i>
                                        Download sample CSV
                                    </button>
                                </div>
                            </div>
                            <pre class="csv-preview" id="csvPreview"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Configuration Preview Modal -->
    <div class="modal-overlay" id="previewConfigModal" style="display: none;">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title" id="previewModalTitle">Preview Configuration</h3>
                <button class="modal-close" id="closePreviewModal">
                    <i class="ph ph-x"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="preview-config-info" id="previewConfigInfo">
                    <!-- Configuration info will be added here -->
                </div>
                <div class="preview-section">
                    <h3 class="preview-section-title">Table Preview</h3>
                    <div class="preview-table-container">
                        <table class="preview-table" id="previewModalTable">
                            <thead id="previewModalTableHead">
                                <!-- Headers will be dynamically added -->
                            </thead>
                            <tbody id="previewModalTableBody">
                                <!-- Rows will be dynamically added -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="preview-section">
                    <div class="preview-section-header">
                        <h3 class="preview-section-title">Raw CSV Preview</h3>
                        <div class="preview-actions">
                            <button class="btn-secondary" id="copyCsvModalBtn">
                                <i class="ph ph-copy"></i>
                                Copy CSV
                            </button>
                            <button class="btn-secondary" id="downloadCsvModalBtn">
                                <i class="ph ph-download"></i>
                                Download sample CSV
                            </button>
                        </div>
                    </div>
                    <pre class="csv-preview" id="previewModalCsv"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="closePreviewModalBtn">Close</button>
            </div>
        </div>
    </div>

    <script src="csv-customizer-v3.js"></script>
</body>
</html>
